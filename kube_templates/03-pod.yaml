apiVersion: v1                      # API version for Pod resource (v1 is the stable version)
kind: Pod                           # Resource type - Pod is the smallest deployable unit in Kubernetes
metadata:                           # Metadata section - contains identifying information
  name: nginx-pod                  # Name of the Pod (must be unique within namespace)
  namespace: default               # Namespace where Pod will be created (optional, defaults to 'default')
  labels:                          # Labels are key-value pairs used for selecting and organizing resources
    app: nginx                     # Label: application name
    version: v1                    # Label: version identifier
    tier: frontend                 # Label: application tier
  annotations:                     # Annotations are metadata that don't affect resource behavior
    description: "Nginx web server pod"  # Custom annotation: human-readable description
    prometheus.io/scrape: "true"   # Example: Prometheus scraping annotation
    prometheus.io/port: "80"       # Example: Prometheus port annotation
  generateName: nginx-pod-         # Generate unique name with prefix (used when creating via API, not in YAML)
  ownerReferences:                 # Owner references for garbage collection (optional, usually auto-set)
  - apiVersion: apps/v1
    kind: Deployment
    name: nginx-deployment
    uid: "12345678-1234-1234-1234-123456789012"
    controller: true               # Whether this owner is a controller
spec:                               # Specification section - defines desired state
  containers:                      # List of containers to run in the pod
  - name: nginx                    # Container name (must be unique within pod)
    image: nginx:1.21.6           # Container image (Docker image name and tag)
    imagePullPolicy: IfNotPresent # When to pull image: Always, Never, IfNotPresent (default: IfNotPresent)
    ports:                         # Container ports to expose
    - name: http                   # Port name (useful for service discovery)
      containerPort: 80            # Port number inside container
      protocol: TCP                # Protocol: TCP, UDP, or SCTP (default: TCP)
      hostPort: 8080               # Port on host to bind to (optional, requires hostNetwork or hostPort)
      hostIP: 127.0.0.1            # Host IP to bind to (optional, requires hostPort)
    - name: https                  # Second port example
      containerPort: 443
      protocol: TCP
    env:                           # Environment variables for the container
    - name: ENV_VAR_1              # Environment variable name
      value: "value1"              # Literal value
    - name: ENV_VAR_2              # Another environment variable
      valueFrom:                   # Get value from another source
        configMapKeyRef:           # Reference to ConfigMap
          name: app-config         # ConfigMap name
          key: config-key          # Key in ConfigMap
          optional: false          # Whether ConfigMap is optional (default: false)
    - name: SECRET_VAR             # Environment variable from Secret
      valueFrom:
        secretKeyRef:              # Reference to Secret
          name: app-secret         # Secret name
          key: secret-key          # Key in Secret
          optional: false          # Whether Secret is optional
    - name: FIELD_VAR              # Environment variable from pod field
      valueFrom:
        fieldRef:                  # Reference to pod field
          fieldPath: metadata.name  # Field path: metadata.name, metadata.namespace, spec.nodeName, status.hostIP, etc.
          apiVersion: v1           # API version (optional, defaults to v1)
    - name: RESOURCE_VAR           # Environment variable from resource field
      valueFrom:
        resourceFieldRef:          # Reference to resource field
          containerName: nginx     # Container name (optional, defaults to current container)
          resource: limits.cpu     # Resource: limits.cpu, limits.memory, requests.cpu, requests.memory
          divisor: "1m"            # Divisor for resource value (optional, e.g., "1m" for CPU, "1Mi" for memory)
    envFrom:                       # Load all environment variables from ConfigMap/Secret
    - configMapRef:                # Reference to entire ConfigMap
        name: app-config           # ConfigMap name
        optional: false            # Whether ConfigMap is optional
        prefix: CONFIG_            # Prefix for environment variable names (optional)
    - secretRef:                   # Reference to entire Secret
        name: app-secret           # Secret name
        optional: false            # Whether Secret is optional
        prefix: SECRET_            # Prefix for environment variable names (optional)
    resources:                     # Resource requests and limits
      requests:                    # Minimum resources required (scheduler uses this)
        cpu: "100m"                # CPU request (100m = 0.1 CPU cores, can use "1" for 1 core)
        memory: "128Mi"            # Memory request (128Mi = 128 mebibytes, can use "1Gi" for 1 gibibyte)
        ephemeral-storage: "1Gi"   # Ephemeral storage request (optional)
        hugepages-2Mi: "100Mi"     # Hugepages request (optional, size must match hugepages limit)
      limits:                      # Maximum resources allowed (container killed if exceeded)
        cpu: "500m"                # CPU limit (500m = 0.5 CPU cores)
        memory: "512Mi"            # Memory limit (512Mi = 512 mebibytes)
        ephemeral-storage: "2Gi"   # Ephemeral storage limit (optional)
        hugepages-2Mi: "200Mi"     # Hugepages limit (optional)
    volumeMounts:                  # Mount volumes into container filesystem
    - name: config-volume          # Volume name (must match volumes.name)
      mountPath: /etc/nginx/conf.d  # Path inside container where volume is mounted
      readOnly: true               # Mount as read-only (default: false)
      subPath: nginx.conf          # Mount specific file/directory from volume (optional)
      subPathExpr: $(POD_NAME)     # SubPath expression using downward API (optional, Kubernetes 1.17+)
      mountPropagation: None       # Mount propagation: None, HostToContainer, Bidirectional (default: None)
    - name: data-volume            # Another volume mount
      mountPath: /var/www/html
      readOnly: false              # Read-write mount
    livenessProbe:                 # Probe to check if container is alive (restarts if fails)
      httpGet:                     # HTTP GET probe
        path: /health              # HTTP path to check
        port: 80                   # Port to check (can be number or name)
        scheme: HTTP               # Scheme: HTTP or HTTPS (default: HTTP)
        httpHeaders:               # Custom HTTP headers (optional)
        - name: Custom-Header
          value: "value"
        host: localhost            # Hostname to connect to (optional, defaults to pod IP)
      initialDelaySeconds: 30     # Seconds to wait before first probe (default: 0)
      periodSeconds: 10            # Seconds between probes (default: 10)
      timeoutSeconds: 5            # Seconds before probe times out (default: 1)
      successThreshold: 1          # Consecutive successes needed to mark as healthy (default: 1)
      failureThreshold: 3          # Consecutive failures needed to mark as unhealthy (default: 3)
    readinessProbe:                # Probe to check if container is ready to serve traffic
      tcpSocket:                   # TCP socket probe (alternative to httpGet)
        port: 80                   # Port to check
        host: localhost            # Hostname to connect to (optional)
      initialDelaySeconds: 5       # Seconds to wait before first probe
      periodSeconds: 5             # Seconds between probes
      timeoutSeconds: 3            # Seconds before probe times out
      successThreshold: 1          # Consecutive successes needed
      failureThreshold: 3          # Consecutive failures needed
    startupProbe:                  # Probe to check if container has started (Kubernetes 1.16+)
      exec:                        # Exec probe (alternative to httpGet/tcpSocket)
        command:                   # Command to execute
        - cat
        - /tmp/healthy
      initialDelaySeconds: 0       # Seconds to wait before first probe
      periodSeconds: 10            # Seconds between probes
      timeoutSeconds: 3            # Seconds before probe times out
      failureThreshold: 30         # Maximum number of failures before container is killed
    securityContext:               # Security settings for container
      runAsNonRoot: true           # Container must run as non-root user (default: false)
      runAsUser: 1000             # UID to run container as (optional)
      runAsGroup: 1000            # GID to run container as (optional)
      allowPrivilegeEscalation: false  # Prevent privilege escalation (default: true)
      readOnlyRootFilesystem: false    # Mount root filesystem as read-only (default: false)
      capabilities:                # Linux capabilities to add/remove
        add:                       # Capabilities to add
        - NET_BIND_SERVICE         # Example: allow binding to privileged ports
        - CHOWN                    # Example: allow changing file ownership
        drop:                      # Capabilities to drop
        - ALL                      # Drop all capabilities, then add only what's needed
      privileged: false           # Run container in privileged mode (default: false)
      seLinuxOptions:              # SELinux options (optional)
        level: "s0:c123,c456"     # SELinux level
        role: "system_r"          # SELinux role
        type: "container_t"       # SELinux type
        user: "system_u"          # SELinux user
      windowsOptions:              # Windows-specific options (optional)
        runAsUserName: "ContainerUser"  # Windows user name
        gmsaCredentialSpecName: "gmsa-spec"  # GMSA credential spec name
        gmsaCredentialSpec: "..."  # GMSA credential spec (inline)
        hostProcess: false        # Run as host process (default: false)
    command:                       # Override container entrypoint (optional)
    - nginx
    - -g
    - "daemon off;"
    args:                          # Override container command arguments (optional)
    - -c
    - /etc/nginx/nginx.conf
    workingDir: /usr/share/nginx/html  # Working directory for container (optional)
    stdin: true                    # Keep stdin open (default: false)
    tty: true                      # Allocate TTY (default: false)
    terminationMessagePath: /dev/termination-log  # Path to termination message file (default: /dev/termination-log)
    terminationMessagePolicy: File # Termination message policy: File or FallbackToLogsOnError
    lifecycle:                     # Lifecycle hooks (optional)
      postStart:                   # Hook executed immediately after container starts
        exec:                      # Exec action
          command:
          - /bin/sh
          - -c
          - "echo 'Container started' > /tmp/started"
      preStop:                     # Hook executed before container terminates
        httpGet:                   # HTTP GET action
          path: /graceful-shutdown
          port: 80
  initContainers:                  # Init containers run before main containers (optional)
  - name: init-myservice           # Init container name
    image: busybox:1.35            # Init container image
    command:                       # Command to run
    - sh
    - -c
    - "echo Initializing..."
    env:                           # Environment variables (same as containers)
    - name: INIT_VAR
      value: "init-value"
    volumeMounts:                  # Volume mounts (same as containers)
    - name: config-volume
      mountPath: /init-config
    resources:                     # Resource requests/limits (same as containers)
      requests:
        cpu: "50m"
        memory: "64Mi"
  volumes:                         # Volumes available to containers in pod
  - name: config-volume            # Volume name (referenced in volumeMounts)
    configMap:                     # Volume from ConfigMap
      name: nginx-config           # ConfigMap name
      items:                       # Specific keys to include (optional, includes all if omitted)
      - key: nginx.conf            # Key in ConfigMap
        path: nginx.conf           # Path in volume
        mode: 0644                 # File permissions (octal)
      defaultMode: 0644           # Default file permissions for all items
      optional: false             # Whether ConfigMap is optional
  - name: data-volume              # Another volume
    emptyDir:                      # Temporary directory shared between containers
      sizeLimit: 1Gi               # Size limit (optional)
      medium: ""                   # Storage medium: "" (default, disk), Memory (tmpfs)
  - name: secret-volume            # Secret volume example
    secret:                        # Volume from Secret
      secretName: nginx-secret     # Secret name
      items:                       # Specific keys to include (optional)
      - key: tls.crt               # Key in Secret
        path: tls.crt              # Path in volume
        mode: 0600                 # File permissions
      defaultMode: 0644           # Default file permissions
      optional: false             # Whether Secret is optional
  - name: pvc-volume               # PersistentVolumeClaim volume example
    persistentVolumeClaim:         # Volume from PVC
      claimName: nginx-pvc        # PVC name
      readOnly: false             # Mount as read-only (default: false)
  - name: downward-api-volume      # Downward API volume example
    downwardAPI:                   # Volume from Downward API
      items:                       # Items to include
      - path: "labels"             # File path in volume
        fieldRef:                  # Reference to pod field
          fieldPath: metadata.labels  # Field path
      - path: "annotations"         # Another file
        fieldRef:
          fieldPath: metadata.annotations
      - path: "cpu_limit"          # Resource field example
        resourceFieldRef:
          containerName: nginx
          resource: limits.cpu
      defaultMode: 0644           # Default file permissions
  - name: projected-volume         # Projected volume example (combines multiple sources)
    projected:                     # Projected volume
      sources:                     # List of volume sources
      - secret:                    # Secret source
          name: nginx-secret
          items:
          - key: tls.crt
            path: tls.crt
      - configMap:                 # ConfigMap source
          name: nginx-config
          items:
          - key: nginx.conf
            path: nginx.conf
      - downwardAPI:               # Downward API source
          items:
          - path: "labels"
            fieldRef:
              fieldPath: metadata.labels
      defaultMode: 0644           # Default file permissions
  - name: host-path-volume         # Host path volume example (for host filesystem access)
    hostPath:                      # Host path volume
      path: /var/lib/docker        # Path on host
      type: DirectoryOrCreate      # Type: DirectoryOrCreate, Directory, FileOrCreate, File, Socket, CharDevice, BlockDevice
  restartPolicy: Always            # Pod restart policy: Always, OnFailure, Never (default: Always)
  terminationGracePeriodSeconds: 30  # Seconds to wait for graceful shutdown (default: 30)
  activeDeadlineSeconds: 3600      # Maximum seconds pod can be active (optional, kills pod if exceeded)
  dnsPolicy: ClusterFirst          # DNS policy: ClusterFirst, ClusterFirstWithHostNet, Default, None
  dnsConfig:                       # Custom DNS configuration (optional)
    nameservers:                   # Custom DNS servers
    - 8.8.8.8
    searches:                      # DNS search domains
    - default.svc.cluster.local
    - svc.cluster.local
    - cluster.local
    options:                       # DNS resolver options
    - name: ndots
      value: "2"
  hostname: nginx-pod              # Pod hostname (optional, defaults to pod name)
  subdomain: nginx                 # Pod subdomain (optional)
  hostAliases:                     # Custom hostname-to-IP mappings (optional)
  - ip: "127.0.0.1"
    hostnames:
    - "foo.local"
    - "bar.local"
  hostNetwork: false               # Use host network namespace (default: false)
  hostPID: false                   # Use host PID namespace (default: false)
  hostIPC: false                   # Use host IPC namespace (default: false)
  shareProcessNamespace: false     # Share process namespace between containers (default: false)
  securityContext:                 # Security settings for pod (applies to all containers)
    runAsNonRoot: true            # Pod must run as non-root user
    runAsUser: 1000              # UID to run pod as
    runAsGroup: 1000             # GID to run pod as
    fsGroup: 2000                # GID for volumes (default: root)
    fsGroupChangePolicy: Always  # When to change ownership: Always, OnRootMismatch
    seccompProfile:              # Seccomp profile (optional)
      type: RuntimeDefault       # Type: RuntimeDefault, Localhost, Unconfined
      localhostProfile: "profiles/audit.json"  # Localhost profile path (for Localhost type)
    supplementalGroups:          # Additional groups for volumes (optional)
    - 2000
    sysctls:                     # Sysctl settings (optional)
    - name: net.core.somaxconn
      value: "1024"
  nodeSelector:                    # Node selection constraints (optional)
    disktype: ssd                 # Node must have label disktype=ssd
    zone: us-west-1a              # Node must have label zone=us-west-1a
  affinity:                        # Advanced scheduling constraints (optional)
    nodeAffinity:                 # Node affinity rules
      requiredDuringSchedulingIgnoredDuringExecution:  # Hard requirement
        nodeSelectorTerms:        # List of node selector terms (OR logic)
        - matchExpressions:       # Match expressions (AND logic)
          - key: kubernetes.io/os
            operator: In
            values:
            - linux
      preferredDuringSchedulingIgnoredDuringExecution:  # Soft preference
      - weight: 100               # Weight (1-100) for preference
        preference:
          matchExpressions:
          - key: disktype
            operator: In
            values:
            - ssd
    podAffinity:                  # Pod affinity rules
      requiredDuringSchedulingIgnoredDuringExecution:  # Hard requirement
      - labelSelector:            # Pods that must be co-located
          matchExpressions:
          - key: app
            operator: In
            values:
            - nginx
        topologyKey: kubernetes.io/hostname  # Topology key (e.g., hostname, zone)
      preferredDuringSchedulingIgnoredDuringExecution:  # Soft preference
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchLabels:
              app: nginx
          topologyKey: kubernetes.io/hostname
    podAntiAffinity:              # Pod anti-affinity rules (spread pods apart)
      requiredDuringSchedulingIgnoredDuringExecution:  # Hard requirement
      - labelSelector:
          matchLabels:
            app: nginx
        topologyKey: kubernetes.io/hostname
      preferredDuringSchedulingIgnoredDuringExecution:  # Soft preference
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchLabels:
              app: nginx
          topologyKey: kubernetes.io/hostname
  tolerations:                     # Tolerations for tainted nodes (optional)
  - key: "key1"                   # Taint key
    operator: Equal               # Operator: Equal or Exists
    value: "value1"               # Taint value (required if operator is Equal)
    effect: NoSchedule            # Taint effect: NoSchedule, PreferNoSchedule, NoExecute
    tolerationSeconds: 3600       # Seconds to tolerate NoExecute taint (optional)
  priorityClassName: high-priority  # Priority class name (optional, for preemption)
  schedulerName: default-scheduler  # Custom scheduler name (optional, default: default-scheduler)
  runtimeClassName: gvisor         # Runtime class name (optional, for different runtimes)
  overhead:                        # Resource overhead for runtime (optional)
    cpu: "100m"
    memory: "128Mi"
  enableServiceLinks: true         # Create environment variables for services (default: true)
  preemptionPolicy: PreemptLowerPriority  # Preemption policy: Never or PreemptLowerPriority
  setHostnameAsFQDN: false         # Set hostname as FQDN (default: false)
  os:                              # Operating system (optional)
    name: linux                    # OS name: linux or windows
  readinessGates:                  # Readiness gates for additional readiness conditions (optional)
  - conditionType: PodScheduled    # Condition type to check

